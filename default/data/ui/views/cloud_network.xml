<form version="1.1" hideFilters="true" theme="dark">
  <label>Network Traffic</label>
  <init>
    <set token="action_dm">*</set>
    <set token="action">*</set>
  </init>
  <fieldset submitButton="false">
    <input type="time" token="field1" searchWhenChanged="true">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Blocked Connections</title>
      <single>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where (All_Traffic.action=blocked OR All_Traffic.action=dropped)</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="height">70</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0xf8be34"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <set token="action_dm">(All_Traffic.action=block* OR All_Traffic.action=drop*)</set>
          <set token="action">blocked</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Allowed Connections</title>
      <single>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where All_Traffic.action=allowed</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="height">70</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xdc4e41","0x53a051"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <set token="action_dm">All_Traffic.action=allowed</set>
          <set token="action">allowed</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Traffic Sources</title>
      <single>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true dc(All_Traffic.src) from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="height">70</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xdc4e41","0x006d9c"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Traffic Destinations</title>
      <single>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true dc(All_Traffic.dest) from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="height">70</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0xdc4e41","0x006d9c"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Logged Traffic Volume</title>
      <single>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true sum(All_Traffic.bytes) as volume from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$ | eval volume=volume/1024/1024/1024</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="height">70</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["0xdc4e41","0x53a051"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unit">GB</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Allowed/Blocked Traffic</title>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$ by _time, All_Traffic.action span=10m 
| timechart minspan=10m count by All_Traffic.action</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Flows</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"allowed": 0x53A051, "blocked": 0xF8BE34, "unknown": 0x999999}</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <link target="_blank">search?q=%60infosec-cloud-indexes%60%20tag%3Dnetwork%20tag%3Dcommunicate%20action%3D$click.name2$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Top Communication by Volume</title>
      <table>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$ by All_Traffic.dest, All_Traffic.src, All_Traffic.bytes
| rename "All_Traffic.*" as "*" 
| stats sum(bytes) as bytes by src, dest 
| eval MBytes=bytes/1024/1024
| sort - bytes 
| fields - bytes 
| head 5</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="number" field="MBytes"></format>
        <format type="color" field="MBytes">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <link target="_blank">/app/InfoSec_Cloud_App_for_Splunk/cloud_asset_investigation?drilldown_host=$click.value2$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title>Traffic by Protocol</title>
      <chart>
        <search>
          <query>| tstats prestats=true summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` $action_dm$ by _time, All_Traffic.transport span=10m 
| timechart minspan=10m count by All_Traffic.transport</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Flows</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="height">240</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <link target="_blank">search?q=%60infosec-cloud-indexes%60%20tag%3Dnetwork%20tag%3Dcommunicate%20action%3D$action$%20transport%3D$click.name2$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top Sources</title>
      <table>
        <search>
          <query>| tstats summariesonly=t allow_old_summaries=t count dc(All_Traffic.dest_port) as num_dest_port dc(All_Traffic.dest_ip) as num_dest_ip from datamodel=Network_Traffic where `infosec-cloud-indexes` $action_dm$ by All_Traffic.src_ip 
| rename All_Traffic.src_ip as src 
| sort - count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="num_dest_ip">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <link target="_blank">/app/InfoSec_Cloud_App_for_Splunk/cloud_asset_investigation?drilldown_host=$click.value$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title>Top Destinations</title>
      <table>
        <search>
          <query>| tstats summariesonly=t allow_old_summaries=t count dc(All_Traffic.dest_port) as num_dest_port dc(All_Traffic.src_ip) as num_src_ip from datamodel=Network_Traffic where `infosec-cloud-indexes` $action_dm$ by All_Traffic.dest_ip | rename All_Traffic.dest_ip as dest
| sort - count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_src_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_port">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_src_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <link target="_blank">/app/InfoSec_Cloud_App_for_Splunk/cloud_asset_investigation?drilldown_host=$click.value$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title>Top Destination Ports</title>
      <table>
        <search>
          <query>| tstats summariesonly=t allow_old_summaries=t count dc(All_Traffic.dest_ip) as num_dest_ip dc(All_Traffic.src_ip) as num_src_ip from datamodel=Network_Traffic where `infosec-cloud-indexes` $action_dm$ by All_Traffic.dest_port 
| rename All_Traffic.dest_port as dest_port 
| sort - count</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">false</option>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="number" field="count">
          <option name="precision">0</option>
        </format>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_dest_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="num_src_ip">
          <colorPalette type="minMidMax" maxColor="#DC4E41" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <link target="_blank">search?q=%60infosec-cloud-indexes%60%20tag%3Dnetwork%20tag%3Dcommunicate%20action%3D$action$%20dest_port%3D$click.value$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>Network Communication Map</h1>
        <p style="color:grey">
        Use the filters below to build a host communication map. Click on host name or IP address in the tables and pie chart below to filter communication information further.</p>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Network Communication Map Filters</title>
      <input type="text" token="protocol_filter" searchWhenChanged="true">
        <label>Protocol Filter</label>
        <default>$protocol_filter$</default>
        <initialValue>*</initialValue>
      </input>
      <input type="text" token="host_filter" searchWhenChanged="true">
        <label>Source/Dest. Host Name or IP</label>
        <default>$host_filter$</default>
        <initialValue>*</initialValue>
      </input>
      <input type="dropdown" token="action_filter" searchWhenChanged="true">
        <label>Allowed/Blocked</label>
        <choice value="*">All</choice>
        <choice value="allowed">Allowed</choice>
        <choice value="blocked">Blocked</choice>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="dropdown" token="min_hosts" searchWhenChanged="true">
        <label>Host Connected to</label>
        <choice value="1">1 host or more</choice>
        <choice value="10">10 hosts or more</choice>
        <choice value="50">50 hosts or more</choice>
        <choice value="100">100 hosts or more</choice>
        <choice value="500">500 hosts or more</choice>
        <choice value="1000">1,000 hosts or more</choice>
        <choice value="5000">5,000 hosts or more</choice>
        <choice value="10000">10,000 hosts or more</choice>
        <default>1</default>
        <initialValue>1</initialValue>
      </input>
      <input type="time" token="field2" searchWhenChanged="true">
        <label>Select Time Range</label>
        <default>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </default>
      </input>
    </panel>
  </row>
  <row>
    <panel>
      <title>Protocols (with Filters Applied)</title>
      <table>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.transport="$protocol_filter$" All_Traffic.action=$action_filter$ (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.transport, All_Traffic.src, All_Traffic.dest 
| append 
    [| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.action=$action_filter$ NOT All_Traffic.transport=* (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
    | eval All_Traffic.transport="unknown" 
    | where "$protocol_filter$"=="*" OR "$protocol_filter$"=="unknown"] 
| rename "All_Traffic.*" AS "*" 
| where src!=dest 
| eventstats dc(dest) AS host_count by src 
| where host_count &gt;= $min_hosts$ 
| stats sum(count) as flows by transport 
| sort - communications 
| table transport, flows</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="connections">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="communications">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="flows">
          <option name="precision">0</option>
        </format>
        <drilldown>
          <eval token="protocol_filter">replace($click.value$,"\\\\","\\\\")</eval>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title># of Destinations Connected to by Source (with Filters Applied)</title>
      <chart>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.transport="$protocol_filter$" All_Traffic.action=$action_filter$ (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
| append 
    [| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.action=$action_filter$ NOT All_Traffic.transport=* (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
    | eval All_Traffic.transport="unknown" 
    | where "$protocol_filter$"=="*" OR "$protocol_filter$"=="unknown"] 
| rename "All_Traffic.*" AS "*" 
| where src!=dest 
| stats dc(dest) AS host_count by src 
| where host_count &gt;= $min_hosts$ 
| sort - host_count 
| head 9999 
| table src, host_count</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.002</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="host_filter">$click.value$</set>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Source and Destination (with Filters Applied)</title>
      <table>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.transport="$protocol_filter$" All_Traffic.action=$action_filter$ (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest, All_Traffic.transport 
| append 
    [| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.action=$action_filter$ NOT All_Traffic.transport=* (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
    | eval All_Traffic.transport="unknown" 
    | where "$protocol_filter$"=="*" OR "$protocol_filter$"=="unknown"] 
| rename "All_Traffic.*" AS "*" 
| where src!=dest 
| eventstats dc(dest) AS host_count by src 
| where host_count &gt;= $min_hosts$ 
| eval source&amp;destination=mvappend(src,dest) 
| sort - count | rename count AS flows
| table source&amp;destination, flows</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">3</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="communications">
          <colorPalette type="minMidMax" maxColor="#006D9C" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="flows">
          <option name="precision">0</option>
        </format>
        <drilldown>
          <set token="host_filter">$click.value2$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Communications Map (Map Shows up to 300 Connections)</title>
      <viz type="network-diagram-viz.network-diagram-viz">
        <title>Double-click to drill down</title>
        <search>
          <query>| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.action=$action_filter$ All_Traffic.transport="$protocol_filter$" (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
| append 
    [| tstats summariesonly=true allow_old_summaries=true count from datamodel=Network_Traffic.All_Traffic where `infosec-cloud-indexes` All_Traffic.action=$action_filter$ NOT All_Traffic.transport=* (All_Traffic.src=$host_filter$ OR All_Traffic.dest=$host_filter$) by All_Traffic.src, All_Traffic.dest 
    | eval All_Traffic.transport="unknown" 
    | where "$protocol_filter$"=="*" OR "$protocol_filter$"=="unknown"] 
| rename "All_Traffic.*" as "*" 
| where NOT (src="unknown" OR dest="unknown" OR src=dest) 
| eventstats dc(dest) AS host_count by src 
| where host_count &gt;= $min_hosts$
| stats count by dest, src 
| head 300 
| eval value=src, from=src, to=dest, type="server", color="#919191" 
| appendpipe 
    [| eval value=dest, from=dest, to="", type="server", color="#e3e3e3"]</query>
          <earliest>$field2.earliest$</earliest>
          <latest>$field2.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">all</option>
        <option name="height">746</option>
        <option name="network-diagram-viz.network-diagram-viz.arrowLocation">middle</option>
        <option name="network-diagram-viz.network-diagram-viz.canZoom">true</option>
        <option name="network-diagram-viz.network-diagram-viz.clusterBy">none</option>
        <option name="network-diagram-viz.network-diagram-viz.defaultLinkLength">100</option>
        <option name="network-diagram-viz.network-diagram-viz.defaultNodeType">circle</option>
        <option name="network-diagram-viz.network-diagram-viz.draggableNodes">true</option>
        <option name="network-diagram-viz.network-diagram-viz.drilldownClick">single</option>
        <option name="network-diagram-viz.network-diagram-viz.enablePhysics">true</option>
        <option name="network-diagram-viz.network-diagram-viz.hierarchy">false</option>
        <option name="network-diagram-viz.network-diagram-viz.hierarchyDirection">Top-Down</option>
        <option name="network-diagram-viz.network-diagram-viz.hierarchySortMethod">directed</option>
        <option name="network-diagram-viz.network-diagram-viz.levelSeparation">150</option>
        <option name="network-diagram-viz.network-diagram-viz.linkTextLocation">bottom</option>
        <option name="network-diagram-viz.network-diagram-viz.linkTextSize">medium</option>
        <option name="network-diagram-viz.network-diagram-viz.nodeSpacing">100</option>
        <option name="network-diagram-viz.network-diagram-viz.nodeTextSize">medium</option>
        <option name="network-diagram-viz.network-diagram-viz.smoothEdgeType">dynamic</option>
        <option name="network-diagram-viz.network-diagram-viz.smoothEdges">true</option>
        <option name="network-diagram-viz.network-diagram-viz.tokenNode">nd_node_token</option>
        <option name="network-diagram-viz.network-diagram-viz.tokenToNode">nd_to_node_token</option>
        <option name="network-diagram-viz.network-diagram-viz.tokenToolTip">nd_tooltip_token</option>
        <option name="network-diagram-viz.network-diagram-viz.tokenValue">nd_value_token</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <link target="_blank">search?q=%60infosec-cloud-indexes%60%20tag%3Dnetwork%20tag%3Dcommunicate%20src%3D%22$nd_value_token$%22%20OR%20dest%3D%22$nd_value_token$%22&amp;earliest=$field2.earliest$&amp;latest=$field2.latest$</link>
        </drilldown>
      </viz>
    </panel>
  </row>
</form>